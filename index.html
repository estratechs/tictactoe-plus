<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your App</title>

  <meta name="theme-color" id="meta-theme-color" content="#ffffff" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="/icons/icon-192.png" />

  <style>
    :root {
      --bg: #ffffff;
      --card: #f6f7f9;
      --text: #0f172a;
      --muted: #475569;
      --ring: #e2e8f0;
      --brand: #2563eb;
      --brand-contrast: #ffffff;
      --menu-shadow: 0 8px 30px rgba(0,0,0,.12);
    }
    :root[data-theme="dark"] {
      --bg: #0b1220;
      --card: #111827;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --ring: #1f2937;
      --brand: #3b82f6;
      --brand-contrast: #0b1220;
      --menu-shadow: 0 10px 40px rgba(0,0,0,.45);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--text);
    }
    .appbar {
      position: sticky; top: 0; z-index: 50;
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px; background: var(--card); border-bottom: 1px solid var(--ring);
    }
    .brand { font-weight: 700; letter-spacing: .2px; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 12px; border: 1px solid var(--ring);
      background: transparent; color: var(--text); cursor: pointer;
    }
    .btn.brand { background: var(--brand); color: var(--brand-contrast); border-color: transparent; }
    .btn:focus { outline: 2px solid var(--brand); outline-offset: 2px; }
    .menu-wrap { position: relative; }
    .menu {
      position: absolute; right: 0; top: calc(100% + 8px);
      min-width: 240px; background: var(--card); border: 1px solid var(--ring);
      box-shadow: var(--menu-shadow); border-radius: 14px; padding: 8px; display: none;
    }
    .menu.open { display: block; animation: pop .12s ease-out; }
    @keyframes pop { from { transform: translateY(-4px); opacity: .0;} to { transform: translateY(0); opacity: 1;} }
    .menu section { padding: 6px 6px; }
    .menu h4 { margin: 8px 8px 6px; font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: .08em; }
    .item {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      padding: 10px 12px; border-radius: 10px; cursor: pointer; user-select: none;
    }
    .item:hover { background: rgba(127,127,127,.08); }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; color: var(--muted); }
    .container { max-width: 960px; margin: 24px auto; padding: 0 16px; }
    .card { background: var(--card); border: 1px solid var(--ring); border-radius: 16px; padding: 16px; }
    .muted { color: var(--muted); }
    .switch { position: relative; width: 46px; height: 28px; background: var(--ring); border-radius: 999px; transition: .2s; }
    .switch i { position: absolute; top: 3px; left: 3px; width: 22px; height: 22px; background: var(--brand); border-radius: 50%; transition: .2s; }
    .switch.on { background: rgba(59,130,246,.25); }
    .switch.on i { left: 21px; }
    .badge { display:inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--ring); font-size: 12px; }
  </style>
</head>
<body>
  <header class="appbar" role="banner">
    <div class="brand">Your App</div>
    <div class="menu-wrap">
      <button class="btn" id="menuBtn" aria-haspopup="true" aria-expanded="false">â˜° Menu</button>
      <div class="menu" id="menu" role="menu" aria-label="App menu">
        <section>
          <h4>Quick actions</h4>
          <div class="item" id="installItem" role="menuitem">
            <span>Install app to Home Screen</span>
            <span class="kbd">PWA</span>
          </div>
          <div class="item" id="reloadItem" role="menuitem">
            <span>Reload</span>
            <span class="kbd">Ctrl/âŒ˜ R</span>
          </div>
        </section>
        <section>
          <h4>Appearance</h4>
          <div class="item" id="themeItem" role="menuitem" aria-label="Toggle light/dark">
            <span>Dark Mode</span>
            <span class="switch" id="themeSwitch"><i></i></span>
          </div>
        </section>
        <section>
          <h4>Status</h4>
          <div class="item" role="status">
            <span>Offline</span>
            <span class="badge" id="offlineBadge">Checkingâ€¦</span>
          </div>
          <div class="item" role="menuitem" id="aboutItem">
            <span>About</span>
            <span class="kbd">v1.0</span>
          </div>
        </section>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="card">
      <h1>Welcome ðŸ‘‹</h1>
      <p class="muted">This shell adds a theme toggle and an app menu with an Install option. Integrate it into your existing layout or start from here.</p>
    </div>
  </main>

  <script>
    // THEME
    const root = document.documentElement;
    const themeSwitch = document.getElementById('themeSwitch');
    const metaTheme = document.getElementById('meta-theme-color');
    function systemPrefersDark() { return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches; }
    function applyTheme(theme) {
      const isDark = theme === 'dark';
      root.setAttribute('data-theme', isDark ? 'dark' : 'light');
      themeSwitch.classList.toggle('on', isDark);
      metaTheme.setAttribute('content', isDark ? '#0b1220' : '#ffffff');
    }
    const saved = localStorage.getItem('theme');
    applyTheme(saved ? saved : (systemPrefersDark() ? 'dark' : 'light'));
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) applyTheme(e.matches ? 'dark' : 'light');
    });
    document.getElementById('themeItem').addEventListener('click', () => {
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      localStorage.setItem('theme', next); applyTheme(next);
    });

    // MENU
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    function closeMenu(){ menu.classList.remove('open'); menuBtn.setAttribute('aria-expanded', 'false'); }
    function openMenu(){ menu.classList.add('open'); menuBtn.setAttribute('aria-expanded', 'true'); }
    menuBtn.addEventListener('click', (e) => { e.stopPropagation(); menu.classList.contains('open') ? closeMenu() : openMenu(); });
    document.addEventListener('click', (e) => { if (!menu.contains(e.target) && e.target !== menuBtn) closeMenu(); });

    // OFFLINE STATUS
    const offlineBadge = document.getElementById('offlineBadge');
    function updateOnlineStatus(){
      if (navigator.onLine) { offlineBadge.textContent = 'Online'; offlineBadge.style.opacity = .8; }
      else { offlineBadge.textContent = 'Offline'; offlineBadge.style.opacity = 1; }
    }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    // PWA INSTALL
    let deferredPrompt = null;
    const installItem = document.getElementById('installItem');
    installItem.style.display = 'none';
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installItem.style.display = 'flex';
    });
    installItem.addEventListener('click', async () => {
      if (!deferredPrompt) { alert('Install not available yet. Try again after browsing a bit.'); return; }
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') installItem.querySelector('span').textContent = 'Installed';
      deferredPrompt = null;
    });

    // RELOAD
    document.getElementById('reloadItem').addEventListener('click', () => location.reload());

    // ABOUT
    document.getElementById('aboutItem').addEventListener('click', () => {
      alert('Your App\nPWA shell with theme + menu.');
    });

    // SW REGISTER
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
